# Collaboration & Debug Tips (Codex <-> Matt)
Purpose: Running log of what worked, what broke, and why.

[2025-08-13 17:00] Topic: Logging DI refactor
Context: Introduced constructor injection for logging services and confirmation helpers.
Observations: Simplifies testing and removes static logger state.
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Use DI to share single logging service and helpers.
Action Items: Monitor CI for Windows-specific behaviors.
Related Commits/PRs: (this PR)
[2025-08-19 12:00] Topic: MQTT will options
Context: Added will message and connection settings to MQTT view model and bound them in create/edit views.
Observations: Properties validate ranges and log warnings; new views expose fields for user input.
Codex Limitations noticed: Linux environment cannot run WPF tests; rely on CI.
Effective Prompts / Instructions that worked: Following AGENTS instructions and user request for property mirroring.
Decisions & Rationale: Mirror `MqttServiceOptions` in view model for consistency and user configurability.
Action Items: Monitor CI for Windows-specific UI issues.
Related Commits/PRs: (this PR)
[2025-08-16 16:30] Topic: WPF reference cleanup
Context: Build failed due to invalid `MouseDoubleClick` handler and ambiguous WinForms references.
Observations: Removed WinForms usage, added WPF media imports, and integrated double-click logic into existing handler.
Codex Limitations noticed: Linux environment lacks WindowsDesktop runtime; tests aborted.
Effective Prompts / Instructions that worked: Reviewing build errors and adjusting XAML and csproj references.
Decisions & Rationale: Consolidate header events and avoid unused events to satisfy warnings-as-errors policy.
Action Items: Rely on CI for full test execution.
Related Commits/PRs: (this PR)

[2025-08-16 15:50] Topic: Service count indicators
Context: Display active service counts and ensure view model notifies on changes.
Observations: TextBlock near add/remove buttons shows active/total services with bindings; unit test covers add/remove/activation.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: Reviewing AGENTS.md and following MVVM update steps.
Decisions & Rationale: Expose service counts to UI for quick monitoring and raise PropertyChanged on all service state changes.
Action Items: Rely on CI for Windows-specific validation.
Related Commits/PRs: (this PR)

[2025-08-15 00:00] Topic: MQTT service refactor
Context: Simplified MQTT client by unifying constructors and publish APIs.
Observations: Connect now disconnects before reconnecting and raises connection state events.
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Reduce surface area and ensure consistent token resolution across publishes.
Action Items: Monitor CI for MQTT regressions.
Related Commits/PRs: (this PR)

[2025-08-13 20:41] Topic: WPF workload in CI
Context: GitHub Actions failed because the `windowsdesktop` workload is no longer recognized.
Observations: Replacing it with the `wpf` workload restores pipeline compatibility.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: verifying commands against GitHub runners.
Decisions & Rationale: Use the `wpf` workload across build, test, quality, and packaging jobs.
Action Items: Monitor CI for workload availability changes.
Related Commits/PRs: (this PR)

[2025-08-13 17:40] Topic: Navigation bar logo
Context: Replaced placeholder text with application logo in main window.
Observations: Logo displays brand and cleans up header.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Use embedded image resource for branding.
Action Items: none
Related Commits/PRs: (this PR)

[2025-08-13 17:52] Topic: Logo resource path fix
Context: Navigation bar logo failed to render because image path was relative to the view folder.
Observations: Using a root-relative path loads the embedded image correctly.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: Providing exact asset location.
Decisions & Rationale: Use root-relative resource paths for WPF assets.
Action Items: Ensure future asset references include leading slash.
Related Commits/PRs: (this PR)


[2025-08-13 18:30] Topic: CI workflow and remote testing
Context: Centralized CI pipeline runs on `feature/**` and `bugfix/**` branches with optional `/test` comment triggers.
Observations: Single workflow handles build, test, quality, and packaging; remote runs compensate for missing WindowsDesktop support locally.
Codex Limitations noticed: `dotnet test` for `net8.0-windows` projects fails on Linux.
Effective Prompts / Instructions that worked: Configuring branch patterns and comment triggers.
Decisions & Rationale: Rely on GitHub-hosted runners for validation and keep AGENTS instructions to review docs.
Action Items: Monitor CI for workload changes and enforce branch protection requiring CI success.
Related Commits/PRs: (this PR)

[2025-08-13 19:01] Topic: Async command refactor
Context: Introduced AsyncRelayCommand and async script evaluation to prevent UI blocking.
Observations: Async command simplifies long-running actions and avoids deadlocks.
Codex Limitations noticed: PowerShell unavailable; tip appended manually.
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Use AsyncRelayCommand for operations needing await without blocking.
Action Items: Monitor for unhandled exceptions in async commands.
Related Commits/PRs: (this PR)

[2025-08-13 19:42] Topic: Remove unused classes
Context: Cleaned up obsolete logging and template control types.
Observations: Deleting `RichTextLogger` and installer `CustomControl1` simplified the codebase with no build impact.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Prefer removing stale classes to reduce maintenance and confusion.
Action Items: Monitor builds for any lingering references.
Related Commits/PRs: (this PR)

[2025-08-16 18:00] Topic: MQTT enhancements
Context: Consolidated MQTT updates: options-based configuration, tokenized endpoint/message publishing, endpoint UI with tooltips, and message routing service.
Observations: Shared options instance simplifies updates and cleanly disconnects before reconnecting. Tests require WindowsDesktop runtime.
Effective Prompts / Instructions that worked: Following AGENTS.md to attempt tests and update docs.
Decisions & Rationale: Centralize configuration via IOptions and route messages through a dedicated service.
Action Items: Validate MQTT behavior via CI test runs.
Related Commits/PRs: (this PR)

[2025-08-16 20:00] Topic: Configuration save guard
Context: Prevented stack overflow when saving empty CSV configuration and ensured main window sizes to content.
Observations: Cloning configuration before serialization avoids recursion; sizing to content keeps controls visible.
Effective Prompts / Instructions that worked: Using `ReferenceHandler.IgnoreCycles` and snapshotting configuration data.
Decisions & Rationale: Detach event references and ignore cycles to ensure safe persistence.
Action Items: Rely on CI to validate serialization and UI sizing.
Related Commits/PRs: (this PR)

[2025-08-17 00:00] Topic: Dependency checks and instruction review
Context: Build failed because `FluentAssertions` was used without a package reference and AGENTS.md wasn't consulted.
Observations: Missing dependencies cause compile errors; instructions files provide required setup details.
Codex Limitations noticed: `net8.0-windows` tests cannot execute on Linux; rely on CI after package restores.
Effective Prompts / Instructions that worked: Reviewing AGENTS and project files before committing.
Decisions & Rationale: Verify `.csproj` files for needed packages and read AGENTS instructions before coding.
Action Items: Add package references when introducing new libraries and document dependency checks in changelog.
Related Commits/PRs: (this PR)
[2025-08-14 19:14] Topic: Reference-safe configuration saves
Context: Avoided stack overflow during configuration persistence by guarding JSON serialization.
Observations: Used ReferenceHandler.IgnoreCycles for settings and service persistence to prevent recursive writes when CSV configuration updates.
Codex Limitations noticed: PowerShell unavailable; appended entry manually.
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Standardize cycle-safe JSON options across services.
Action Items: Monitor CI for serialization regressions.
Related Commits/PRs: (this PR)


[2025-08-17 12:00] Topic: CSV file naming and key handling
Context: Adjusted CSV service file naming to respect `{index}` placeholder and confirmed main window only responds to Escape key.
Observations: Incrementing index only when placeholder is present prevents runaway file creation; added regression tests for key handling and cyclic service persistence.
Codex Limitations noticed: Linux environment lacks WPF runtime, preventing full test execution.
Effective Prompts / Instructions that worked: Reviewing AGENTS instructions and prior changelog before editing.
Decisions & Rationale: Follow placeholder presence to advance index and ensure keyboard events remain scoped to Escape.
Action Items: Rely on CI to execute Windows-specific tests.
Related Commits/PRs: (this PR)

[2025-08-17 18:00] Topic: CSV logging recursion
Context: Stack overflow occurred when CSV service logged its own writes.
Observations: Logging within CsvService re-entered LoggingService and triggered infinite RecordLog loops.
Codex Limitations noticed: cannot catch StackOverflowException reliably; rely on snapshot then fail fast.
Effective Prompts / Instructions that worked: request to wrap saves and add debug command.
Decisions & Rationale: Removed internal logging from CsvService and added serialization guards producing dump files on overflow.
Action Items: Use DebugSaveCommand for minimal reproduction and examine dump files if Environment.FailFast is triggered.
Related Commits/PRs: (this PR)

[2025-08-18 12:00] Topic: Window header double-click
Context: Named navigation header and added drag and double-click handlers.
Observations: Header drag restores window dragging; double-click toggles maximize state.
Codex Limitations noticed: Linux environment lacks WPF runtime, so rely on CI for full validation.
Effective Prompts / Instructions that worked: Direct request to wire header events and provide unit test.
Decisions & Rationale: Provide familiar window management behavior through code-behind handlers.
Action Items: Monitor CI for Windows-specific regressions.
Related Commits/PRs: (this PR)

[2025-08-18 17:30] Topic: Service creation bubble UI
Context: Replaced text and combo selection with icon bubbles that auto-generate service names.
Observations: Streamlines service creation and reduces user input errors.
Codex Limitations noticed: Missing WindowsDesktop workload prevented local test execution.
Effective Prompts / Instructions that worked: Following AGENTS.md to attempt tests and document changes.
Decisions & Rationale: Expose service metadata from the view model for UI binding and name generation.
Action Items: Rely on CI for cross-platform validation.
Related Commits/PRs: (this PR)

[2025-08-19 12:00] Topic: MQTT will options
Context: Added will message and connection settings to MQTT view model and bound them in create/edit views.
Observations: Properties validate ranges and log warnings; new views expose fields for user input.
Codex Limitations noticed: Linux environment cannot run WPF tests; rely on CI.
Effective Prompts / Instructions that worked: Following AGENTS instructions and user request for property mirroring.
Decisions & Rationale: Mirror `MqttServiceOptions` in view model for consistency and user configurability.
Action Items: Monitor CI for Windows-specific UI issues.
Related Commits/PRs: (this PR)

[2025-08-18 21:00] Topic: Service name uniqueness
Context: Prevented duplicate service names during creation and rename operations.
Observations: New services and renames auto-append numeric suffixes when collisions occur.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: request to handle duplicates via GenerateServiceName.
Decisions & Rationale: Ensure consistent name uniqueness across sessions and persistence.
Action Items: Monitor persistence for unexpected duplicate entries.
Related Commits/PRs: (this PR)
[2025-08-15 17:39] Topic: CSV service view integration
Context: Moved CSV Creator from a pop-up window to an embedded page.
Observations: CsvServiceView now loads within ContentFrame when the service is opened.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: Reusing existing window layout ensured quick conversion to a page.
Decisions & Rationale: Align CSV Creator with other services to simplify navigation.
Action Items: Monitor CI for UI test reliability.
Related Commits/PRs: (this PR)
[2025-08-15 17:51] Topic: Auto-start default
Context: AppSettings and configuration files now default AutoStart to disabled.
Observations: StartupService leaves auto-start disabled unless explicitly enabled.
Codex Limitations noticed: PowerShell unavailable; tip appended manually.
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Disable auto-start by default to prevent unintended application launches.
Action Items: Rely on CI to validate registry updates on Windows.
Related Commits/PRs: (this PR)

[2025-08-15 18:40] Topic: SDK upgrade to 8.0.404
Context: Pinned `global.json` to .NET SDK 8.0.404 to align with documentation.
Observations: `dotnet --info` shows the required SDK is missing and tests cannot run.
Codex Limitations noticed: Linux environment lacks .NET SDK 8.0.404 and WindowsDesktop support.
Effective Prompts / Instructions that worked: Version update and verification steps.
Decisions & Rationale: Ensure consistent SDK version across developers and CI.
Action Items: Install .NET SDK 8.0.404 locally and validate tests on Windows CI.
Related Commits/PRs: (this PR)

[2025-08-19 00:00] Topic: Log reload behavior
Context: Logging service now reloads previous session entries and respects minimum level changes.
Observations: Replaying log file entries keeps UI history after restart.
Codex Limitations noticed: None
Effective Prompts / Instructions that worked: Specifying constructor loading and reload method.
Decisions & Rationale: Read log file at startup and expose reload for level filter updates.
Action Items: Monitor duplicate entries when reloading filters.
Related Commits/PRs: (this PR)

[2025-08-19 14:41] Topic: MQTT service creation view
Context: Added dedicated view to configure MQTT options during service creation.
Observations: Navigation within CreateServiceWindow collects broker settings and returns options to main window.
Codex Limitations noticed: net8.0-windows tests cannot run on Linux.
Effective Prompts / Instructions that worked: Following AGENTS instructions to add docs and tests.
Decisions & Rationale: Capture MQTT settings before service addition for smoother workflow.
Action Items: Rely on CI to validate WPF bindings.
Related Commits/PRs: (this PR)

[2025-08-15 20:40] Topic: Inline filter popup
Context: Replaced separate filter window with popup-based FilterPanel triggered from main view.
Observations: Users adjust service filters without leaving the main window.
Codex Limitations noticed: Linux environment lacks WindowsDesktop runtime; rely on CI for UI validation.
Effective Prompts / Instructions that worked: Direct request to embed filters via Popup with StaysOpen=false.
Decisions & Rationale: Use WPF Popup hosting FilterPanel to provide unobtrusive, in-place filtering.
Action Items: Monitor CI for popup interaction regressions.
Related Commits/PRs: (this PR)

[2025-08-16 15:50] Topic: Service count indicators
Context: Display active service counts and ensure view model notifies on changes.
Observations: TextBlock near add/remove buttons shows active/total services with bindings; unit test covers add/remove/activation.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: Reviewing AGENTS.md and following MVVM update steps.
Decisions & Rationale: Expose service counts to UI for quick monitoring and raise PropertyChanged on all service state changes.
Action Items: Rely on CI for Windows-specific validation.
Related Commits/PRs: (this PR)
[2025-08-16 16:30] Topic: WPF reference cleanup
Context: Build failed due to invalid `MouseDoubleClick` handler and ambiguous WinForms references.
Observations: Removed WinForms usage, added WPF media imports, and integrated double-click logic into existing handler.
Codex Limitations noticed: Linux environment lacks WindowsDesktop runtime; tests aborted.
Effective Prompts / Instructions that worked: Reviewing build errors and adjusting XAML and csproj references.
Decisions & Rationale: Consolidate header events and avoid unused events to satisfy warnings-as-errors policy.
Action Items: Rely on CI for full test execution.
Related Commits/PRs: (this PR)
[2025-08-16 20:55] Topic: Service count binding mode
Context: App crashed on startup due to TwoWay binding on read-only service count properties.
Observations: Set Run.Text bindings to Mode=OneWay to avoid InvalidOperationException.
Codex Limitations noticed: Linux environment cannot run WPF for full verification.
Effective Prompts / Instructions that worked: Error message pointing to CurrentActiveServices binding.
Decisions & Rationale: Explicitly specify one-way bindings for read-only properties.
Action Items: Rely on CI to validate on Windows.
Related Commits/PRs: (this PR)

[2025-08-19 10:00] Topic: MQTT will/reconnect options
Context: Extended MQTT client to apply will message, QoS, retain flag, keep-alive, clean session, and reconnect delay with structured option logging.
Observations: ConnectAsync now loops using ReconnectDelay after failures to improve resilience.
Codex Limitations noticed: dotnet SDK missing; tests could not run locally.
Effective Prompts / Instructions that worked: request to update MqttService.ConnectAsync.
Decisions & Rationale: Honor retry delay and expose connection options for observability.
Action Items: Rely on CI for verification of MQTT features.

[2025-08-19 12:00] Topic: MQTT will options
Context: Added will message and connection settings to MQTT view model and bound them in create/edit views.
Observations: Properties validate ranges and log warnings; new views expose fields for user input.
Codex Limitations noticed: Linux environment cannot run WPF tests; rely on CI.
Effective Prompts / Instructions that worked: Following AGENTS instructions and user request for property mirroring.
Decisions & Rationale: Mirror `MqttServiceOptions` in view model for consistency and user configurability.
Action Items: Monitor CI for Windows-specific UI issues.

[2025-08-19 14:40] Topic: MQTT tag subscriptions view
Context: Added dedicated view and view model for managing MQTT topic subscriptions and test messages.
Observations: New view displays topics on creation and connects service when activated.
Codex Limitations noticed: Windows desktop tests cannot run in container.
Effective Prompts / Instructions that worked: Followed AGENTS instructions and existing MQTT patterns.
Decisions & Rationale: Replace basic MQTT view with subscription-focused view for clarity.
Action Items: Verify on Windows via CI.
Related Commits/PRs: (this PR)

[2025-08-19 14:57] Topic: MqttCreateServiceView build error
Context: Page contained both a StackPanel and ScrollViewer after merge, breaking build.
Observations: Removing the StackPanel allowed Page to host a single ScrollViewer and compile.
Codex Limitations noticed: `pwsh` not available to run add-tip script.
Effective Prompts / Instructions that worked: Following merge instructions to ensure each Page has one child.
Decisions & Rationale: Keep ScrollViewer with Grid as the sole content to maintain layout.
Action Items: Monitor CI for other XAML compilation issues.
Related Commits/PRs: (this PR)

[2025-08-19 15:35] Topic: ViewModel and MQTT option tests
Context: Added unit tests for MQTT create, subscription, and edit view models plus TLS/credential coverage in MQTT service tests.
Observations: Tests cover validation, command behavior, and option mapping.
Codex Limitations noticed: Linux container skips Windows-specific tests; rely on CI.
Effective Prompts / Instructions that worked: Followed AGENTS guidance to update changelog and tips.
Decisions & Rationale: Improve confidence in new view models and advanced connection options.
Action Items: Run full test suite in CI.
Related Commits/PRs: (this PR)

[2025-08-19 15:10] Topic: Mqtt QoS enum namespace
Context: Build failed because `MqttCreateServiceViewModel` lacked the `MQTTnet.Protocol` import.
Observations: Adding the using directive restored `MqttQualityOfServiceLevel` references.
Codex Limitations noticed: `dotnet test` exposed additional WPF compile errors on Linux.
Effective Prompts / Instructions that worked: n/a
Decisions & Rationale: Ensure files referencing MQTT enums include `MQTTnet.Protocol`.
Action Items: Rely on CI for full Windows validation.
Related Commits/PRs: (this PR)
[2025-08-20 12:00] Topic: MQTT edit flow routing
Context: Routed new MQTT services from creation through tag subscriptions and switched editing to a dedicated connection view.
Observations: Removing legacy MQTT view resolved missing helper build errors.
Codex Limitations noticed: dotnet CLI unavailable on container; relied on CI for validation.
Effective Prompts / Instructions that worked: Following AGENTS instructions to update routing and persistence.
Decisions & Rationale: Preserve existing event handlers while swapping views and save services after edits.
Action Items: Ensure CI covers MQTT edit scenarios.
Related Commits/PRs: (this PR)
[2025-08-20 16:00] Topic: MQTT view registrations
Context: Ensured new MQTT views and view models use transient lifetime and added file dialog helper to DI.
Observations: Transient registration prevents state leakage; file picker service supports TLS certificate selection.
Codex Limitations noticed: none
Effective Prompts / Instructions that worked: Following AGENTS guidance and user request.
Decisions & Rationale: Use transient lifetimes for views/view models and provide IFileDialogService for TLS cert browsing.
Action Items: Monitor CI for DI regressions.
Related Commits/PRs: (this PR)
[2025-08-19 15:55] Topic: MQTT subscription result bubbles
Context: Added Subscribe/Unsubscribe APIs, QoS-aware tag subscription model, and UI feedback bubbles.
Observations: Async commands allow subscription attempts with success/failure notifications.
Codex Limitations noticed: Linux environment cannot render WPF; rely on CI.
Effective Prompts / Instructions that worked: Following request to capture results and update docs.
Decisions & Rationale: Store per-topic QoS and message; visualize subscription outcomes for user clarity.
Action Items: Monitor CI for UI styling discrepancies.
Related Commits/PRs: (this PR)
